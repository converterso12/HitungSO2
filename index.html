<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perhitungan Kadar SO2</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Perhitungan Kadar SO2</h1>
        <form id="so2-form">
            <label for="c-value">Nilai C:</label>
            <input type="number" id="c-value" step="0.00001" value="0.10282">

            <label for="v-value">Nilai V (ml):</label>
            <input type="number" id="v-value" value="10">

            <label for="pt-value">Nilai Pt:</label>
            <input type="number" id="pt-value" step="0.001" value="0.855">

            <div class="button-group">
                <button type="button" onclick="saveConstants()">Simpan Konstanta</button>
            </div>
        </form>

        <label for="test-time">Waktu:</label>
        <input type="datetime-local" id="test-time">

        <label for="v1-value">Nilai V1:</label>
        <input type="number" id="v1-value" step="0.01">

        <div class="button-group">
            <button type="button" onclick="calculateSO2()">Hitung</button>
        </div>

        <div id="result"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
        import { getDatabase, ref, set, push, child, get } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDwcwcIdTSPUadytFCh8RqBM8zCVtXEo-I",
            authDomain: "dataso2-id.firebaseapp.com",
            databaseURL: "https://dataso2-id-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "dataso2-id",
            storageBucket: "dataso2-id.appspot.com",
            messagingSenderId: "1084913028872",
            appId: "1:1084913028872:web:d3588f12dcbeed0cec26bd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        function saveConstants() {
            const c = parseFloat(document.getElementById('c-value').value);
            const v = parseFloat(document.getElementById('v-value').value);
            const pt = parseFloat(document.getElementById('pt-value').value);

            set(ref(db, 'constants'), { c, v, pt })
                .then(() => alert('Konstanta tersimpan!'))
                .catch((error) => console.error('Error saving constants:', error));
        }

        function calculateSO2() {
            const v1 = parseFloat(document.getElementById('v1-value').value);
            const time = document.getElementById('test-time').value;

            if (!time || isNaN(v1)) {
                alert('Masukkan waktu dan nilai V1 yang valid!');
                return;
            }

            const constantsRef = ref(db, 'constants');

            get(constantsRef).then((snapshot) => {
                if (snapshot.exists()) {
                    const { c, v, pt } = snapshot.val();
                    const so2 = (c * v * 10.945) / (pt * v1 + (c * v * 10.945)) * 100;

                    const newEntryRef = push(child(ref(db), 'so2-data'));
                    set(newEntryRef, {
                        time: new Date(time).toISOString(),
                        v1: v1,
                        pt: pt,
                        so2: so2
                    }).then(() => {
                        alert('Perhitungan tersimpan!');
                        document.getElementById('result').innerText = `Kadar SO2: ${so2.toFixed(2)}%`;
                    }).catch((error) => console.error('Error saving calculation:', error));
                } else {
                    alert('Konstanta belum disimpan!');
                }
            }).catch((error) => console.error('Error getting constants:', error));
        }
    </script>
</body>
</html>
